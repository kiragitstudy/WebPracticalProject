@using WebPracticalProject.Domain.Common
@model WebPracticalProject.Service.Dto.PagedResult<WebPracticalProject.Service.Dto.UserVm>
@{
  ViewData["Title"] = "Пользователи";
}
<div class="container py-4">
  <h1 class="h3 mb-4">Пользователи</h1>
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Email</th>
          <th>Имя</th>
          <th>Роль</th>
          <th class="text-end">Действия</th>
        </tr>
      </thead>
      <tbody>
      @foreach (var u in Model.Items)
      {
        <tr>
          <td>@u.Email</td>
          <td>@(u.DisplayName ?? "—")</td>
          <td class="text-capitalize">@u.Role</td>
          <td class="text-end">
            <form asp-action="UpdateUser" asp-controller="Admin" method="post" class="d-inline">
              @Html.AntiForgeryToken()
              <input type="hidden" name="id" value="@u.Id" />
              <select name="Role" class="form-select form-select-sm d-inline w-auto me-2">
                <option value="Customer" selected="@(UserRole.Customer==u.Role)">customer</option>
                <option value="Manager"  selected="@(UserRole.Manager==u.Role)">manager</option>
                <option value="Admin"    selected="@(UserRole.Admin==u.Role)">admin</option>
              </select>
              <button class="btn btn-sm btn-outline-primary" type="submit">Сохранить</button>
            </form>
            <form asp-action="DeleteUser" asp-controller="Admin" method="post" class="d-inline ms-2" onsubmit="return confirm('Удалить пользователя?')">
              @Html.AntiForgeryToken()
              <input type="hidden" name="id" value="@u.Id" />
              <button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
            </form>
          </td>
        </tr>
      }
      </tbody>
    </table>
  </div>
  @{
    var p = Model.Page; var total = Model.Total; var size = Model.Size; var pages = Math.Max(1, (int)Math.Ceiling((double)total/size));
  }
  <nav>
    <ul class="pagination">
      <li class="page-item @(p<=1?"disabled":null)"><a class="page-link" href="@Url.Action("Users", new { page = p-1, size })">Назад</a></li>
      <li class="page-item disabled"><span class="page-link">@p / @pages</span></li>
      <li class="page-item @(p>=pages?"disabled":null)"><a class="page-link" href="@Url.Action("Users", new { page = p+1, size })">Вперёд</a></li>
    </ul>
  </nav>
</div>
